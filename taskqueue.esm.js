const e=require("pino"),r=require("numeral"),t=e({level:process.env.LOGGER||"info",prettyPrint:{levelFirst:!0,translateTime:"SYS:yyyy-mm-dd HH:MM:ss.l",crlf:!0},prettifier:require("pino-pretty")});function n(e,r,t){return o(e*(t-r)/r)}function o(e){let t=(e=Number.parseInt(e))%1e3,n=(e=Number.parseInt(e/1e3))%60,o=(e=Number.parseInt(e/60))%60,a=Number.parseInt(e/60);return`${r(a).format("00")}:${r(o).format("00")}:${r(n).format("00")}.${r(t).format("000")}`}export default function(e,r=20,a="默认任务队列"){let l=[],i=0,u=[],$=Date.now(),f=0;for(let s=0;s<r;s++)l[s]=new Promise(async(r,l)=>{try{for(;e&&i<e.length;){let r=i,l=e[r].args;i++,t.debug(`【${a}】${s} - 执行第${i}个任务，参数【%o】`,l);try{u[r]=await e[r].caller(...l)}catch(e){t.error(`【${a}】${s} - 执行错误，%o`,e)}f++;let m=Date.now()-$,c=n(m,f,e.length);t.debug(`【${a}】${s} - 完成第${r+1}个任务！`),t.info(`【${a}】 已经完成${f}/${e.length}个任务，已经使用时间：${o(m)}, 预计还需要时间：${c}`)}r()}catch(e){l(e)}});return l}
